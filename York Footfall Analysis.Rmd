---
title: "York Street Footfall Analysis for Optimal Vendor Positioning"
author: "Chien-Hao Wang"
output:
  html_document:
    toc: true
    toc_depth: 3
  pdf_document:
    toc: true
    toc_depth: '3'
editor_options:
  chunk_output_type: console
---

---

```{r setup, message=FALSE}

library(tidyverse)
library(ggplot2)
library(gridExtra)
library(Hmisc)
library(kableExtra)
options(width=100)

```

This report addresses the promoter’s objectives by executing the specified statistical analyses to evaluate footfall patterns.

1. Provide a summary table that shows the essential statistics for each location where footfall was measured.

2. Visualise the daily distribution of footfall for each location in the year 2019.

3. Perform a two-sided t-test to compare the footfall on Coney Street to Stonegate during 2019. 

4. Perform an additional t-test to compare the footfall on Coney Street to Stonegate only on weekends (i.e. Saturdays/Sundays) during 2019.

5. Provide a recommendation to the promoter, who will decide where the stall should be placed in York.

---

# Data Understanding

## Data Dictionary

The variables are described in the table below.

Variable | Description
------------- | -------------
Date| The date the record was created
SiteName | The site where the record was collected
LocationName| The location where the record was collected
WeekDay| The day the record was collected
TotalCount| The number of people who walk past a particular location
Recording_ID| Unique ID of each record was created

---

# Data Processing

## Read data
```{r}
# Load the whole York footfall data
york_footfall <- read_csv("York_Footfall_data.csv")

# Check the structure of york_footfall and confirm the Date column is datetime type
str(york_footfall)
```

## Check the continuous data and plot the data
```{r}
# Plot the continuous data to see whether it has outliers
ggplot(york_footfall, aes(TotalCount)) + 
  geom_histogram(binwidth = 100) 

# Based on the histogram I created, some data has a value larger than 100,000, which is necessary to exclude as outliers. To confirm whether these data would affect the conclusion and the york_footfall dataset, I used two tables, one before and one after excluding outliers, respectively, including a summary statistic of the TotalCount column.

summary.stat.exclud.outliers <- york_footfall %>%
  filter(TotalCount < 100000) 

summary.stat.original <- york_footfall$TotalCount

describe(summary.stat.exclud.outliers$TotalCount)
describe(summary.stat.original)

# After checking the summary statistics, records which are larger than 100,000 wouldn't cause significant effect on the original data. Removing outliers can help me conduct a more robust analysis.

# 7 records with TotalCount larger than 100,000 are removed.
york_footfall.outlier <- york_footfall %>%
  filter(TotalCount > 100000)

york_footfall.outlier

# Additionally, it is crucial to find if a missing value exists. The TotalCount column has 10 data, and the Recording_ID column has 100 data.
map(york_footfall, ~sum(is.na(.)))

# However, looking into the missing table, recorders likely forgot to type the ID, or systems did not assign the identifier to this record. Because these records all have TotalCount values, removing them is not essential.

york_footfall.missing <- york_footfall %>%
  filter(is.na(TotalCount) | is.na(Recording_ID))

head(york_footfall.missing)

# According to the histogram plot, it is a highly right-skewed distribution with the majority of observations concentrated between 0 and roughly 30,000.
ggplot(york_footfall, aes(TotalCount)) + 
  geom_histogram(binwidth = 100) +
  xlim(0, 100000)
```

## Check the discrete and categorical data
```{r}

count(york_footfall, LocationName) #Although some locations contain less data, it don't seem to have any error such as wrong typing etc.

count(york_footfall, WeekDay) #According to the result, the weekday data don't present any errors because there is no weird index other than weekdays.

# Based on these examinations, there are no potential errors in these columns.
```

## Data Cleaning
Firstly, records for missing values in the columns of TotalCount from the york_footfall data will be removed. Data with a TotalCount value larger than 100,000 will also be excluded since they are abnormal and could affect the following analysis
```{r}
# Filter the missing data and outliers out to ensure this data's integrity and quality.
york_footfall <- york_footfall %>%
  filter(!is.na(TotalCount)) %>%
  filter(TotalCount < 100000)

head(york_footfall)
```

---

# Analysis

## 1. Provide a summary table that shows the essential statistics for each location where footfall was measured.

```{r}
# Create a summary table containing required statistics and information.
summary.table <- york_footfall %>% 
  group_by(LocationName) %>%
  summarise(
    FirstDay = min(Date), 
    LastDay = max(Date),
    MeanFootfall = round(mean(TotalCount)),
    StddevFootfall = round(sd(TotalCount)),
    HighestFoofall = max(TotalCount),
    LowestFootfall = min(TotalCount)) %>%
  select(LocationName, FirstDay, LastDay, MeanFootfall, StddevFootfall, HighestFoofall, LowestFootfall)

summary.table
```



## 2. Create another data only containing the data from 2019-01-01 to 2019-12-31 (the last full year before the COVID pandemic).
```{r}
# Filter the date of data ranging from 2019-01-01 to 2019-12-31
york_footfall.2019 <- york_footfall %>% filter(Date >= '2019-01-01' & Date <= '2019-12-31')

head(york_footfall.2019)
```

## 3. Plot the distribution of footfall across all days in the dataset.

```{r, warning = FALSE}
# Add the Days_of_The_Week column to indicate data recorded at weekends and set LocationName and Days_of_The_Week in a specific order, leading to the plots of Coney Street and Stonegate being on the same column, a display fitted to the following analysis.

york_footfall.2019 <- york_footfall.2019 %>%
  mutate(
    LocationName = factor(LocationName, levels = c("Coney Street", "Micklegate", "Stonegate", "Parliament Street")),
    Days_of_The_Week = factor(ifelse(WeekDay %in% c("Saturday", "Sunday"), "Weekend", "Weekday"), 
                              levels = c("Weekday", "Weekend")))

# Plot the distribution plot

york.plot <- york_footfall.2019 %>%
  ggplot(york_footfall.2019, mapping = aes(fill = Days_of_The_Week, x = TotalCount)) +
  geom_histogram(alpha = 0.8, binwidth = 500, position = "stack") +
  facet_wrap(~ LocationName, ncol=2, nrow = 2) + 
  labs(
    caption = "Figure 1: Distribution of Daily Footfall Across Locations in 2019",
    x = "Daily Footfall Count (Number of Passers)",
    y = "Frequency (Days)"
  ) + 
  # Assign specific colours to the difference of weekdays and weekends
  scale_fill_manual(values = c("Weekday" = "#F59885", "Weekend" = "#86B1D3"), name = "Days of The Week") + 
  # Change the theme of plot into light
  theme_light() +
  # Change the style and size of x and y axis
  theme(
    axis.title.x = element_text(size = 12, face = "bold"),                    
    axis.title.y = element_text(size = 12, face = "bold"),
    strip.text = element_text(size = 12, color = "black", face = "bold")
  )

york.plot
```

The plot shows that the daily footfall in Micklegate ranged from 5,000 to 10,000, a lower volume than in other locations. According to the distribution plot (Figure 1), the other three locations have a more similar pattern of daily footfall, a more significant proportion of attracting 15,000 to 20,000 passers during the weekdays. In contrast, according to legends that show on the right side of the plot, they also perform a common phenomenon that happened in four locations: footfall at weekends is typically higher than on weekdays. Some days, there is an exceptionally high volume in Stonegate, which is valuable for finding the reason.

## 4. Perform a two-sided t-test to compare the footfall on Coney Street to Stonegate. 
```{r}
# Subset data for Coney Street and Stonegate
all_days_data <- york_footfall.2019 %>%
  filter(LocationName %in% c("Coney Street", "Stonegate"))

# Main t-test (all available days)
t.test(TotalCount ~ LocationName, data = all_days_data)

# Sensitivity check: exclude days with very high counts
# (cap chosen based on inspection of the histogram; used only for robustness check)
upper_cap <- 40000

all_days_no_extreme <- all_days_data %>%
  filter(TotalCount < upper_cap)

t.test(TotalCount ~ LocationName, data = all_days_no_extreme)
```

The average number of daily passers on Coney Street is 20,817, compared with 19,204 on Stonegate, a difference of 1,613 passers.
This difference is statistically significant, $t(699.18) = 3.36$, $p = 0.0008$.

Figure 2 supports this result: the distribution for Coney Street is shifted to the right, and the mean footfall line lies clearly to the right of that for Stonegate.

To check whether the conclusion is driven by a small number of very high footfall values, a **sensitivity analysis** was conducted by excluding days with TotalCount ≥ 40,000. The t-test on this restricted sample remains significant and the difference in means is similar, indicating that the finding that Coney Street attracts higher daily footfall than Stonegate is robust to the treatment of these extreme values.

```{r, warning=FALSE}
# Prepare the mean footfall on Coney Street and Stonegate (all days)
mean_total_count.all.days <- all_days_data %>%
  group_by(LocationName) %>%
  summarise(mean_count = mean(TotalCount), .groups = "drop")

# Histogram for all days
plot1 <- all_days_data %>%
  ggplot(aes(x = TotalCount, fill = LocationName)) +
  geom_histogram(alpha = 0.8, binwidth = 500, position = "stack") +
  facet_wrap(~ LocationName, nrow = 2) +
  labs(
    caption = "Figure 2: Comparative Distribution of Daily Footfall on Coney Street and Stonegate in 2019",
    x = "Daily Footfall Count (Number of Passers)",
    y = "Frequency (Days)"
  ) +
  geom_vline(data = mean_total_count.all.days,
             aes(xintercept = mean_count), size = 0.6) +
  geom_text(data = mean_total_count.all.days,
            aes(x = mean_count, y = 50, label = "Mean Footfall"),
            hjust = -0.2, size = 3.5) +
  theme_light() +
  theme(
    axis.title.x = element_text(size = 12, face = "bold"),
    axis.title.y = element_text(size = 12, face = "bold"),
    strip.text   = element_text(size = 12, colour = "black", face = "bold")
  )

plot1
```


## 5. Perform an additional two-sided t-test to compare the footfall on Coney Street to Stonegate only on weekends (i.e. Saturdays/Sundays).
```{r}
# Subset weekend data (Saturdays and Sundays only)
weekend_data <- york_footfall.2019 %>%
  filter(LocationName %in% c("Coney Street", "Stonegate"),
         WeekDay %in% c("Saturday", "Sunday"))

# Main weekend t-test
t.test(TotalCount ~ LocationName, data = weekend_data)

# Sensitivity check on weekends using the same upper cap
weekend_no_extreme <- weekend_data %>%
  filter(TotalCount < upper_cap)

t.test(TotalCount ~ LocationName, data = weekend_no_extreme)
```

At weekends, the mean number of daily passers is 25,863 on Coney Street and 26,167 on Stonegate, a difference of 304 passers.
The two-sided t-test shows that this difference is not statistically significant, $t(203.88) = −0.29$, $p = 0.772$.

This is consistent with Figure 3, where the weekend distributions of the two locations look broadly similar, with only a slight difference in their mean lines.

As with the all-days analysis, a sensitivity check was carried out by excluding days with TotalCount ≥ 40,000. After removing these extreme values, the mean weekend footfall is 25,512 on Coney Street and 25,019 on Stonegate, a difference of 493 passers. However, this difference remains non-significant, $t(198) = 0.53$, $p = 0.599$.

This confirms that the conclusion of no meaningful difference in average weekend footfall between the two streets is not sensitive to how these extreme days are treated.

```{r}
# Prepare the mean weekend footfall
mean_total_count.weekends <- weekend_data %>%
  group_by(LocationName) %>%
  summarise(mean_count = mean(TotalCount), .groups = "drop")

# Histogram for weekends
plot2 <- weekend_data %>%
  ggplot(aes(x = TotalCount, fill = LocationName)) +
  geom_histogram(alpha = 0.8, binwidth = 500, position = "stack") +
  facet_wrap(~ LocationName, nrow = 2) +
  labs(
    caption = "Figure 3: Distribution of Daily Footfall on Coney Street and Stonegate at weekends in 2019",
    x = "Daily Footfall Count (Number of Passers)",
    y = "Frequency (Days)"
  ) +
  geom_vline(data = mean_total_count.weekends,
             aes(xintercept = mean_count), size = 0.6) +
  geom_text(data = mean_total_count.weekends,
            aes(x = mean_count, y = 50, label = "Mean Footfall"),
            hjust = -0.2, size = 3.5) +
  theme_light() +
  theme(
    axis.title.x = element_text(size = 12, face = "bold"),
    axis.title.y = element_text(size = 12, face = "bold"),
    strip.text   = element_text(size = 12, colour = "black", face = "bold")
  )

plot2

```

---

# Recommendation to The Promoter
Based on the findings above: 

- **All days of the week**
Coney Street records a significantly higher average daily footfall than Stonegate, and this result is robust to the exclusion of extreme high-footfall days.

  *Recommendation*: If the stall is to be placed every day, Coney Street is the preferred location for maximising exposure.

- **Weekends only (Saturdays/Sundays)**
The difference in average weekend footfall between Coney Street and Stonegate is not statistically significant, and this conclusion does not change when extreme days are excluded. Stonegate occasionally shows very high counts, but these are infrequent; Coney Street offers a slightly more stable pattern.

  *Recommendation*: When operating only at weekends, either street is viable, but Coney Street is marginally preferred as a more consistent and lower-risk option.