---
title: 'York Street Footfall Analysis for Optimal Vendor Positioning'
author: 'Chien-Hao Wang'
output:
  html_document:
    toc: yes
    toc_depth: 3
editor_options: 
  chunk_output_type: console
---

---

```{r setup, message=FALSE}

library(tidyverse)
library(ggplot2)
library(gridExtra)
library(Hmisc)
library(kableExtra)
options(width=100)

```

This report addresses the promoterâ€™s objectives by executing the specified statistical analyses to evaluate footfall patterns.

1. Provide a summary table that shows the essential statistics for each location where footfall was measured.

2. Visualise the daily distribution of footfall for each location in the year 2019.

3. Perform a two-sided t-test to compare the footfall on Coney Street to Stonegate during 2019. 

4. Perform an additional t-test to compare the footfall on Coney Street to Stonegate only on weekends (i.e. Saturdays/Sundays) during 2019.

5. Provide a recommendation to the promoter, who will decide where the stall should be placed in York.

---

# Data Understanding

## Data Dictionary

The variables are described in the table below.

Variable | Description
------------- | -------------
Date| The date the record was created
SiteName | The site where the record was collected
LocationName| The location where the record was collected
WeekDay| The day the record was collected
TotalCount| The number of people who walk past a particular location
Recording_ID| Unique ID of each record was created

---

# Data Processing

## Read data
```{r}
# Load the whole York footfall data
york_footfall <- read_csv("York_Footfall_data.csv")

# Check the structure of york_footfall and confirm the Date column is datetime type
str(york_footfall)
```

## Check the continuous data and plot the data
```{r}
# Plot the continuous data to see whether it has outliers
ggplot(york_footfall, aes(TotalCount)) + 
  geom_histogram(binwidth = 100) 

# Based on the histogram I created, some data has a value larger than 100,000, which is necessary to exclude as outliers. To confirm whether these data would affect the conclusion and the york_footfall dataset, I used two tables, one before and one after excluding outliers, respectively, including a summary statistic of the TotalCount column.

summary.stat.exclud.outliers <- york_footfall %>%
  filter(TotalCount < 100000) 

summary.stat.original <- york_footfall$TotalCount

describe(summary.stat.exclud.outliers$TotalCount)
describe(summary.stat.original)

# After checking the summary statistics, records which are larger than 100,000 wouldn't cause significant effect on the original data. Removing outliers can help me conduct a more robust analysis.

# 7 records with TotalCount larger than 100,000 are removed.
york_footfall.outlier <- york_footfall %>%
  filter(TotalCount > 100000)

york_footfall.outlier

# Additionally, it is crucial to find if a missing value exists. The TotalCount column has 10 data, and the Recording_ID column has 100 data.
map(york_footfall, ~sum(is.na(.)))

# However, looking into the missing table, recorders likely forgot to type the ID, or systems did not assign the identifier to this record. Because these records all have TotalCount values, removing them is not essential.

york_footfall.missing <- york_footfall %>%
  filter(is.na(TotalCount) | is.na(Recording_ID))

head(york_footfall.missing)

# According to the histogram plot, it is a highly right-skewed distribution with the majority of observations concentrated between 0 and roughly 30,000.
ggplot(york_footfall, aes(TotalCount)) + 
  geom_histogram(binwidth = 100) +
  xlim(0, 100000)
```

## Check the discrete and categorical data
```{r}

count(york_footfall, LocationName) #Although some locations contain less data, it don't seem to have any error such as wrong typing etc.

count(york_footfall, WeekDay) #According to the result, the weekday data don't present any errors because there is no weird index other than weekdays.

# Based on these examinations, there are no potential errors in these columns.
```

## Data Cleaning
Firstly, records for missing values in the columns of TotalCount from the york_footfall data will be removed. Data with a TotalCount value larger than 100,000 will also be excluded since they are abnormal and could affect the following analysis
```{r}
# Filter the missing data and outliers out to ensure this data's integrity and quality.
york_footfall <- york_footfall %>%
  filter(!is.na(TotalCount)) %>%
  filter(TotalCount < 100000)

head(york_footfall)
```

---

# Analysis

## 1. Provide a summary table that shows the essential statistics for each location where footfall was measured.

```{r}
# Create a summary table containing required statistics and information.
summary.table <- york_footfall %>% 
  group_by(LocationName) %>%
  summarise(
    FirstDay = min(Date), 
    LastDay = max(Date),
    MeanFootfall = round(mean(TotalCount)),
    StddevFootfall = round(sd(TotalCount)),
    HighestFoofall = max(TotalCount),
    LowestFootfall = min(TotalCount)) %>%
  select(LocationName, FirstDay, LastDay, MeanFootfall, StddevFootfall, HighestFoofall, LowestFootfall)

summary.table
```



## 2. Create another data only containing the data from 2019-01-01 to 2019-12-31 (the last full year before the COVID pandemic).
```{r}
# Filter the date of data ranging from 2019-01-01 to 2019-12-31
york_footfall.2019 <- york_footfall %>% filter(Date >= '2019-01-01' & Date <= '2019-12-31')

head(york_footfall.2019)
```

## 3. Plot the distribution of footfall across all days in the dataset.

```{r, warning = FALSE}
# Add the Days_of_The_Week column to indicate data recorded at weekends and set LocationName and Days_of_The_Week in a specific order, leading to the plots of Coney Street and Stonegate being on the same column, a display fitted to the following analysis.

york_footfall.2019 <- york_footfall.2019 %>%
  mutate(
    LocationName = factor(LocationName, levels = c("Coney Street", "Micklegate", "Stonegate", "Parliament Street")),
    Days_of_The_Week = factor(ifelse(WeekDay %in% c("Saturday", "Sunday"), "Weekend", "Weekday"), 
                              levels = c("Weekday", "Weekend")))

# Plot the distribution plot

york.plot <- york_footfall.2019 %>%
  ggplot(york_footfall.2019, mapping = aes(fill = Days_of_The_Week, x = TotalCount)) +
  geom_histogram(alpha = 0.8, binwidth = 500, position = "stack") +
  facet_wrap(~ LocationName, ncol=2, nrow = 2) + 
  labs(
    caption = "Figure 1: Distribution of Daily Footfall Across Locations in 2019",
    x = "Daily Footfall Count (Number of Passers)",
    y = "Frequency (Days)"
  ) + 
  # Assign specific colours to the difference of weekdays and weekends
  scale_fill_manual(values = c("Weekday" = "#F59885", "Weekend" = "#86B1D3"), name = "Days of The Week") + 
  # Change the theme of plot into light
  theme_light() +
  # Change the style and size of x and y axis
  theme(
    axis.title.x = element_text(size = 12, face = "bold"),                    
    axis.title.y = element_text(size = 12, face = "bold"),
    strip.text = element_text(size = 12, color = "black", face = "bold")
  )

york.plot
```

The plot shows that the daily footfall in Micklegate ranged from 5,000 to 10,000, a lower volume than in other locations. According to the distribution plot (Figure 1), the other three locations have a more similar pattern of daily footfall, a more significant proportion of attracting 15,000 to 20,000 passers during the weekdays. In contrast, according to legends that show on the right side of the plot, they also perform a common phenomenon that happened in four locations: footfall at weekends is typically higher than on weekdays. Some days, there is an exceptionally high volume in Stonegate, which is valuable for finding the reason.

## 4. Perform a two-sided t-test to compare the footfall on Coney Street to Stonegate. 
```{r}
york_footfall.2019 %>%
  filter(LocationName %in% c("Coney Street", "Stonegate")) %>%
  t.test(TotalCount~LocationName, data = .)

# After removing outliers to improve the outcome of t-test analysis. The outcome does not affect the conclusion that the number of passers on Coney Street is significantly higher than those on Stonegate.

york_footfall.2019 %>%
  filter(TotalCount < 40000) %>%
  filter(LocationName %in% c("Coney Street", "Stonegate")) %>%
  t.test(TotalCount~LocationName, data = .)
```

The average number of daily passers on Coney Street is 20,817. Stonegate has an average of 19,204 passers, 1,613 fewer than those on Coney Street. The difference of 1,613 is statistically significant, $t(699.18) = 3.3611$, $p=0.0008$. It is also presented on the Figure 2, showing the average of footfall on Coney Street is larger than that on Stonegate and having significantly difference.

```{r, warning=FALSE}
# Prepare the mean footfall only on Coney Street and Stonegate
mean_total_count.all.days <- york_footfall.2019 %>%
  filter(LocationName %in% c("Coney Street", "Stonegate")) %>%
  group_by(LocationName) %>%
  summarise(mean_count = mean(TotalCount), .groups = 'drop')

# Plot a histogram to show intuitive picture telling the difference between the mean footfall on two locaations
plot1 <- york_footfall.2019 %>%
  filter(LocationName %in% c("Coney Street", "Stonegate")) %>%
  ggplot(york_footfall.2019, mapping = aes(x = TotalCount, fill = LocationName)) +
  geom_histogram(alpha = 0.8, binwidth = 500, position = "stack") +
  facet_wrap(~ LocationName, nrow=2) + 
  labs(
    caption = "Figure 2: Comparative Distribution of Daily Footfall on Coney Street and Stonegate in 2019",
    x = "Daily Footfall Count (Number of Passers)",
    y = "Frequency (Days)"
  ) + 
  
  # Add lines to indicate the average of Footfall on Coney Street and Stonegate
  geom_vline(data = mean_total_count.all.days, 
             aes(xintercept = mean_count), size = 0.6) +
  geom_text(data = mean_total_count.all.days, 
            aes(x = mean_count, y = 50, label = "Mean Footfall"),
            hjust = -0.2, size = 3.5) +
  theme_light() +
  theme(
    axis.title.x = element_text(size = 12, face = "bold"),                    
    axis.title.y = element_text(size = 12, face = "bold"),
    strip.text = element_text(size = 12, color = "black", face = "bold")
  )

plot1
```


## 5. Perform an additional two-sided t-test to compare the footfall on Coney Street to Stonegate only on weekends (i.e. Saturdays/Sundays).
```{r}
york_footfall.2019 %>%
  filter(LocationName %in% c("Coney Street", "Stonegate") & WeekDay %in% c("Saturday", "Sunday")) %>%
  t.test(TotalCount~LocationName, data = .)

# The t-test removing outliers was also conducted, and the outcome still indicates the significant difference between Coney Street and Stonegate, specifically on weekends.

york_footfall.2019 %>%
  filter(TotalCount < 40000) %>%
  filter(LocationName %in% c("Coney Street", "Stonegate") & WeekDay %in% c("Saturday", "Sunday")) %>%
  t.test(TotalCount~LocationName, data = .)
```

Particularly at weekends, 25,863 passers on Coney Street are compared to 26,167 passers on Stonegate. However, the difference of 304 is not statistically significant: $t(203.88) = -0.29072$, $p=0.7716$. It also shows at the Figure 3, a slightly different in the mean footfall.

```{r}
# Prepare the mean footfall only on Coney Street and Stonegate at weekends
mean_total_count.weekends <- york_footfall.2019 %>%
  filter(LocationName %in% c("Coney Street", "Stonegate") & Days_of_The_Week == "Weekend") %>%
  group_by(LocationName) %>%
  summarise(mean_count = mean(TotalCount), .groups = 'drop')

# Plot a histogram to show intuitive picture telling the difference between the mean footfall on two locaations only at weekends
plot2 <- york_footfall.2019 %>%
  filter(LocationName %in% c("Coney Street", "Stonegate") & Days_of_The_Week == "Weekend") %>%
  ggplot(york_footfall.2019, mapping = aes(x = TotalCount, fill = LocationName)) +
  geom_histogram(alpha = 0.8, binwidth = 500, position = "stack") +
  facet_wrap(~ LocationName, nrow=2) + 
  labs(
    caption = "Figure 3: Distribution of Daily Footfall on Coney Street and Stonegate at weekends in 2019",
    x = "Daily Footfall Count (Number of Passers)",
    y = "Frequency (Days)"
  ) + 
  
  # Add lines to indicate the average of Footfall on Coney Street and Stonegate
  geom_vline(data = mean_total_count.weekends, 
             aes(xintercept = mean_count), size = 0.6) +
  geom_text(data = mean_total_count.weekends, 
            aes(x = mean_count, y = 50, label = "Mean Footfall"),
            hjust = -0.2, size = 3.5) +
  theme_light() +
  theme(
    axis.title.x = element_text(size = 12, face = "bold"),                    
    axis.title.y = element_text(size = 12, face = "bold"),
    strip.text = element_text(size = 12, color = "black", face = "bold")
  )

plot2

```

Moreover, after removing outliers, there were 25,512 passers on Coney Street. On Stonegate, there are 25,019 passers, which is a difference of 493. Although the difference is still not statistically significant, the average number of passers on Coney Street is higher than those on Stonegate, $t(198) = 0.52608$, $p=0.5994$.

---

# Recommendation to The Promoter
Based on the findings above: 

- For every day of the week: Coney Street is recommended for maximising footfall, as it has a significantly higher daily average than Stonegate across all days. 

- For weekends only: There is no statistically significant difference in footfall between Coney Street and Stonegate. Therefore, Coney Street is the more recommended place to place the stall, although Stonegate may offer a slightly higher volume of weekend passers. The t-test analysis removing outliers presents a more consistent pattern of passers on Coney Street than Stonegate. Therefore, I will recommend to place the stall on Coney Street.